---
title: "R Notebook"
---

```{r, include=FALSE}
library(dplyr)
library(tidyr)
library(rio)
library(gsheet)
```

# Import all 
```{r}
ver <- "v2.2"
sourceloc <- "../data/"
metaloc <- "../data_raw/"
#meta <- list.files(path = "./data/", pattern = "_sourcesym.txt", recursive = T)
source.long <- list.files(path = sourceloc, pattern = "_sourcesym.txt", recursive = T, full.names = T)
source.short <- basename(source.long)

meta.long <- list.files(path = metaloc, pattern = "_metasym.txt", recursive = T, full.names = T)
meta.short <- basename(meta.long)

#layers <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1JIV92XisuBctBoVT53yqj0orPNRVyRQVEDtMq7R0fKw/edit?usp=sharing")
layers <- rio::import(paste0("layers_metadata/", ver, "/layers_metadata_", ver, ".xlsx"))
layers <- filter(layers, is.na(file_name) == FALSE)
```

```{r}
df <- data.frame("short_name" = as.character(1:nrow(layers)), "sourcesym" = NA)

for(i in 1:nrow(layers)){
  v1 <- layers$sourcesym[i]
  v2 <- source.short
  m <- source.long[which(v2 %in% v1)]
  
  df$short_name[i] <- layers$short_name[i]
  df$sourcesym[i] <- m
}
```

```{r}
l <- vector(mode = "list", length = nrow(df))
for(i in 1:nrow(df)){
  f <- paste0(sourceloc, df$sourcesym[i])
  f <- read.table(f, header = T)
  l[[i]] <- f$id
  #cat("\nIt", i, f$id)
}

```

```{r}

for(i in 1:length(l)){
  for(j in 1:length(l[[i]])){
    p <- paste0(l[[i]][j], "_metasym.txt")
  }
  
}
```

```{r}
p <- paste0(l[[1]][1], "_metasym.txt")
f <- list.files(path = metaloc, pattern = p, recursive = T, full.names = T)
f <- read.table(f, header = F)

f <- setNames(data.frame(t(f[,-1])), f[,1])
```


**********************************

```{r}
#for(i in 1:nrow(df)){
for(i in 1:17){
  f <- paste0(sourceloc, df$sourcesym[i])
  f <- read.table(f, header = T)
  cat("\nIt", i, f$id)
}
```

*****************

```{r}
v1 <- meta.short
v2 <- layers$sourcesym

meta <- meta[which(v1 %in% v2)]
```

```{r}
l <- list.files("../data_raw", recursive = T, full.names = T)
df <- data.frame("short_name" = NA)
```



```{r}
df <- read.delim(l[grep(f$id[2], l)])
```

*********************

```{r}
df <- data.frame("short_name" = as.character(1:nrow(layers)), "sourcesym" = NA)

for(i in 1:nrow(layers)){
  v1 <- layers$sourcesym[i]
  v2 <- meta.short
  m <- meta[which(v2 %in% v1)]
  
  df$short_name[i] <- layers$short_name[i]
  df$sourcesym[i] <- m
}
```

