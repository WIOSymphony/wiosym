---
title: "R Notebook"
output: html_notebook
---

# Specify version
```{r}
ver <- "v2"

dir.create(paste0(ver, "/output_geotiffs/eco"), recursive = T)
dir.create(paste0(ver, "/output_geotiffs/pres"), recursive = T)
```

```{r, warning=FALSE}
library(dplyr)
library(tidyr)
library(rio)
library(rjson)
library(jsonlite)
library(gsheet)

meta <- rio::import(paste0("layer_list_", ver, ".xlsx"))
meta$file_name[is.na(meta$file_name)] <- "placeholder.tif"
```

# Create JSON files for metadata - ECOSYSTEMS
```{r}
layers <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1JIV92XisuBctBoVT53yqj0orPNRVyRQVEDtMq7R0fKw/edit?usp=sharing") |> dplyr::filter(theme == "Ecosystem")
#layers <- rio::import(paste0("layer_list_", ver, ".xlsx")) |> dplyr::filter(theme == "Ecosystem")
layers$file_name[is.na(layers$file_name)] <- "placeholder.tif"

js <- read_json(path = "datasetTemplate.json")

#for(i in 1:nrow(layers)){
for(i in 49:49){

# Name, description, etc.
js$name <- paste0(layers$title[i], " - ", layers$description[i], " - ecosystem component from the WIO Symphony tool")
js$description <- layers$method_summary[i]
js$`@id` <- "https://github.com/WIOSymphony/wiosym/tree/main/products/v2/output_geotiffs/eco/dugong.json"
js$url <- ""
js$sameAs[[1]] <- ""
js$citation <- "Sacre, E, 2022"
js$version <- paste0(ver,".0")
js$distribution$contentUrl <- "https://github.com/WIOSymphony/wiosym/tree/main/products/v2/output_geotiffs/eco/dugong.tif"


# Keywords
js$keywords[[1]] <- "Western Indian Ocean"
js$keywords[[2]] <- "WIO Symphony"
js$keywords[[3]] <- "Symphony"
js$keywords[[4]] <- "Cumulative impact assessment"
js$keywords[[5]] <- "Marine spatial planning"
js$keywords[[6]] <- "Ecosystems"
js$keywords[[7]] <- "Pressures"
js$keywords[[8]] <- layers$title[i]
js

# Export JSON

n <- layers$title[i]
n <- tolower(n) |> 
     gsub(pattern = " ", replacement = "_", fixed = T) |> 
     gsub(pattern = "(", replacement = "_", fixed = T) |> 
     gsub(pattern = ")", replacement = "_", fixed = T) |> 
     gsub(pattern = "__", replacement = "_", fixed = T) |>
     sub(pattern = "_$", replacement = "")

write_json(js, path = paste0(ver, "/output_geotiffs/eco/", n, ".json"),
             pretty = TRUE,
             auto_unbox = TRUE)

}
```

# Create JSON files for metadata - PRESSURES
```{r}
layers <- gsheet2tbl("docs.google.com/spreadsheets/d/1JIV92XisuBctBoVT53yqj0orPNRVyRQVEDtMq7R0fKw/edit?usp=sharing") |> dplyr::filter(theme == "Pressure")
#layers <- rio::import(paste0("layer_list_", ver, ".xlsx")) |> dplyr::filter(theme == "Ecosystem")
layers$file_name[is.na(layers$file_name)] <- "placeholder.tif"
```

